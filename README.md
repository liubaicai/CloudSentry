# CloudSentry äº‘å«å®‰å…¨

CloudSentryï¼ˆäº‘å«å®‰å…¨ï¼‰æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„å®‰å…¨äº‹ä»¶ç®¡ç†å¹³å°ï¼Œä½¿ç”¨ TypeScript æ„å»ºã€‚å®ƒæä¾›äº†ä¸€ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºæ¥æ”¶ã€å­˜å‚¨ã€åˆ†æå’Œç®¡ç†æ¥è‡ª syslog æºçš„å®‰å…¨å‘Šè­¦å’Œäº‹ä»¶ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **ç”¨æˆ·è®¤è¯**: åŸºäº JWT çš„è®¤è¯ç³»ç»Ÿï¼Œæ”¯æŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- ğŸ“Š **å®‰å…¨ä»ªè¡¨ç›˜**: å®æ—¶ç»Ÿè®¡æ•°æ®å’Œå®‰å…¨äº‹ä»¶å¯è§†åŒ–å±•ç¤º
- ğŸš¨ **å¨èƒç®¡ç†**: é«˜çº§å®‰å…¨äº‹ä»¶è¿‡æ»¤å’Œåˆ†æï¼Œæ”¯æŒå¢å¼ºçš„å¨èƒå­—æ®µ
- ğŸ” **å¨èƒè¯¦æƒ…**: å•ä¸ªå®‰å…¨äº‹ä»¶çš„è¯¦ç»†è§†å›¾å’Œç®¡ç†
- ğŸ‘¥ **ç”¨æˆ·ç®¡ç†**: å®Œæ•´çš„ç”¨æˆ·è´¦æˆ·ç®¡ç†ï¼Œæ”¯æŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- ğŸ“ˆ **èšåˆåˆ†æ**: æ¨¡å¼æ£€æµ‹å’Œè¶‹åŠ¿åˆ†æï¼ˆå¯æ‰©å±•ï¼‰
- ğŸŒ **é€šé“ç®¡ç†**: è·Ÿè¸ªå’Œç®¡ç† syslog æºï¼Œæ”¯æŒè‡ªåŠ¨å‘ç°
- ğŸ”„ **å­—æ®µæ˜ å°„**: æ™ºèƒ½ syslog å­—æ®µåˆ°æ•°æ®åº“æ¨¡å¼çš„æ˜ å°„å’Œè½¬æ¢
- ğŸ¤– **AI æ™ºèƒ½æ˜ å°„**: ä½¿ç”¨ OpenAI å…¼å®¹ API è‡ªåŠ¨ç”Ÿæˆå­—æ®µæ˜ å°„ âœ¨ æ–°åŠŸèƒ½
- â° **æ•°æ®ä¿ç•™**: è‡ªåŠ¨æ¸…ç†æ—§æ•°æ®ï¼Œæ”¯æŒå¯é…ç½®çš„ä¿ç•™ç­–ç•¥ï¼ˆé»˜è®¤ 7 å¤©ï¼‰âœ¨ æ–°åŠŸèƒ½
- ğŸ“¤ **å‘Šè­¦è½¬å‘**: é…ç½®è§„åˆ™å°†å‘Šè­¦è½¬å‘åˆ°å¤–éƒ¨ç³»ç»Ÿï¼ˆwebhookã€é‚®ä»¶ã€syslogï¼‰
- âš™ï¸ **ç³»ç»Ÿè®¾ç½®**: å¯é…ç½®çš„ç³»ç»Ÿå‚æ•°
- ğŸŒ **ç½‘ç»œé…ç½®**: ç½‘ç»œæ¥å£å’Œè¿æ¥è®¾ç½®ç®¡ç†
- ğŸ”§ **è¿ç»´é…ç½®**: è¿ç»´ç­–ç•¥åŒ…æ‹¬ä¿ç•™ã€å¤‡ä»½å’Œç»´æŠ¤
- ğŸ”’ **å®‰å…¨é…ç½®**: å®‰å…¨ç­–ç•¥å’Œè®¤è¯è®¾ç½®
- ğŸ’¾ **æ•°æ®ç®¡ç†**: æ•°æ®åº“ç»Ÿè®¡ã€å¯¼å‡ºã€å¤‡ä»½å’Œç»´æŠ¤å·¥å…·
- ğŸ”Œ **Syslog æœåŠ¡**: TCP/UDP Syslog æœåŠ¡å™¨ï¼ˆç«¯å£ 514ï¼‰å’Œ RESTful API ç«¯ç‚¹

## æŠ€æœ¯æ ˆ

### åç«¯
- **Node.js** + **TypeScript**
- **Express.js** - Web æ¡†æ¶
- **PostgreSQL** - æ•°æ®åº“
- **Prisma** - ç°ä»£ ORM
- **JWT** - è®¤è¯
- **Winston** - æ—¥å¿—
- **OpenAI SDK** - AI é©±åŠ¨çš„å­—æ®µæ˜ å°„ âœ¨ æ–°åŠŸèƒ½
- **åŸç”Ÿ Syslog æœåŠ¡å™¨** - TCP/UDP ç«¯å£ 514 âœ¨ æ–°åŠŸèƒ½

### å‰ç«¯
- **React 18** + **TypeScript**
- **Vite** - æ„å»ºå·¥å…·
- **Ant Design** - UI ç»„ä»¶åº“
- **React Router** - è·¯ç”±
- **Recharts** - æ•°æ®å¯è§†åŒ–
- **Axios** - HTTP å®¢æˆ·ç«¯
- **Caddy** - åå‘ä»£ç†å’Œ Web æœåŠ¡å™¨

## é¡¹ç›®ç»“æ„

```
CloudSentry/
â”œâ”€â”€ backend/                 # åç«¯ API æœåŠ¡å™¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/    # è¯·æ±‚å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ routes/         # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ middleware/     # Express ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ config/         # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ prisma/             # æ•°æ®åº“æ¨¡å¼å’Œè¿ç§»
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ frontend/               # React å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/     # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/          # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ services/       # API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ contexts/       # React ä¸Šä¸‹æ–‡
â”‚   â”‚   â””â”€â”€ types/          # TypeScript ç±»å‹
â”‚   â””â”€â”€ package.json
â””â”€â”€ docker-compose.yml      # Docker é…ç½®
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js 18+ 
- PostgreSQL 14+
- npm æˆ– yarn

### å®‰è£…æ­¥éª¤

1. **å…‹éš†ä»“åº“**
   ```bash
   git clone https://github.com/liubaicai/CloudSentry.git
   cd CloudSentry
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   npm run install:all
   ```

3. **é…ç½®åç«¯**
   ```bash
   cd backend
   cp .env.example .env
   # ç¼–è¾‘ .env æ–‡ä»¶é…ç½®æ•°æ®åº“å‡­è¯
   
   # è¿è¡Œæ•°æ®åº“è¿ç§»
   npm run prisma:migrate
   npm run prisma:generate
   ```

4. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
   
   ç»ˆç«¯ 1 - åç«¯ï¼š
   ```bash
   npm run dev:backend
   ```
   
   ç»ˆç«¯ 2 - å‰ç«¯ï¼š
   ```bash
   npm run dev:frontend
   ```

5. **è®¿é—®åº”ç”¨**
   - å‰ç«¯ç•Œé¢: http://localhost:5173
   - åç«¯ API: http://localhost:3000
   - API å¥åº·æ£€æŸ¥: http://localhost:3000/health
   - Syslog æœåŠ¡: TCP/UDP ç«¯å£ 514

### ä½¿ç”¨ Docker

```bash
docker-compose up -d
```

è¿™å°†å¯åŠ¨ï¼š
- PostgreSQL æ•°æ®åº“ï¼ˆç«¯å£ 5432ï¼‰
- åç«¯ APIï¼ˆç«¯å£ 3000ï¼‰
- å‰ç«¯ç•Œé¢ï¼ˆç«¯å£ 5173ï¼‰
- Syslog æœåŠ¡ï¼ˆTCP/UDP ç«¯å£ 514ï¼‰

## API æ–‡æ¡£

### è®¤è¯

**æ³¨å†Œ**
```bash
POST /api/auth/register
Content-Type: application/json

{
  "username": "admin",
  "email": "admin@example.com",
  "password": "password123",
  "role": "admin"
}
```

**ç™»å½•**
```bash
POST /api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "password123"
}
```

### Syslog æ•°æ®æ¥å…¥

**åŸç”Ÿ Syslog åè®®ï¼ˆæ¨èï¼‰**

æ”¯æŒæ ‡å‡† RFC 3164 å’Œ RFC 5424 æ ¼å¼çš„ syslog æ¶ˆæ¯ï¼š
```bash
# å‘é€ syslog æ¶ˆæ¯åˆ° UDP ç«¯å£
echo "<14>Jan 13 10:00:00 myhost myapp[1234]: Test security event" | nc -u localhost 514

# å‘é€ syslog æ¶ˆæ¯åˆ° TCP ç«¯å£
echo "<14>Jan 13 10:00:00 myhost myapp[1234]: Test security event" | nc localhost 514
```

**HTTP API - å•æ¡äº‹ä»¶**
```bash
POST /api/syslog
Content-Type: application/json

{
  "timestamp": "2024-01-12T10:30:00Z",
  "severity": "critical",
  "category": "intrusion",
  "source": "192.168.1.100",
  "destination": "192.168.1.200",
  "message": "æ£€æµ‹åˆ°å¯ç–‘æ´»åŠ¨",
  "protocol": "TCP",
  "port": 22,
  "tags": ["ssh", "æš´åŠ›ç ´è§£"]
}
```

**HTTP API - æ‰¹é‡äº‹ä»¶**
```bash
POST /api/syslog/bulk
Content-Type: application/json

[
  {
    "severity": "high",
    "category": "malware",
    "source": "192.168.1.105",
    "message": "æ£€æµ‹åˆ°æ¶æ„è½¯ä»¶"
  },
  {
    "severity": "medium",
    "category": "policy_violation",
    "source": "192.168.1.110",
    "message": "æ£€æµ‹åˆ°ç­–ç•¥è¿è§„"
  }
]
```

### äº‹ä»¶ç®¡ç†

**è·å–äº‹ä»¶åˆ—è¡¨**
```bash
GET /api/events?page=1&limit=20&severity=critical&status=new
Authorization: Bearer <token>
```

**æ›´æ–°äº‹ä»¶çŠ¶æ€**
```bash
PATCH /api/events/:id
Authorization: Bearer <token>
Content-Type: application/json

{
  "status": "resolved",
  "assignedTo": "admin"
}
```

### ä»ªè¡¨ç›˜

**è·å–ç»Ÿè®¡æ•°æ®**
```bash
GET /api/dashboard/stats
Authorization: Bearer <token>
```

**è·å–æ—¶é—´åºåˆ—æ•°æ®**
```bash
GET /api/dashboard/timeseries?days=7
Authorization: Bearer <token>
```

## é»˜è®¤å‡­è¯

é¦–æ¬¡å®‰è£…åï¼Œæ‚¨éœ€è¦é€šè¿‡ API æˆ–æ³¨å†Œé¡µé¢åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ã€‚

æµ‹è¯•ç”¨æˆ·ï¼š
- ç”¨æˆ·å: `admin`
- å¯†ç : `admin123`
- é‚®ç®±: `admin@cloudsentry.local`

## é…ç½®è¯´æ˜

### åç«¯ç¯å¢ƒå˜é‡

åœ¨ `backend` ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
DATABASE_URL="postgresql://postgres:password@localhost:5432/cloudsentry?schema=public"
JWT_SECRET="your-super-secret-jwt-key-change-in-production"
JWT_EXPIRES_IN="7d"
PORT=3000
NODE_ENV="development"
CORS_ORIGIN="http://localhost:5173"
```

### å‰ç«¯ç¯å¢ƒå˜é‡

åœ¨ `frontend` ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ï¼š

```env
VITE_API_URL=/api
```

## å¼€å‘æŒ‡å—

### æ•°æ®åº“è¿ç§»

```bash
cd backend
npm run prisma:migrate      # åˆ›å»ºå¹¶åº”ç”¨è¿ç§»
npm run prisma:generate     # ç”Ÿæˆ Prisma å®¢æˆ·ç«¯
npm run prisma:studio       # æ‰“å¼€ Prisma Studio
npm run prisma:seed         # å¡«å……ç¤ºä¾‹æ•°æ®
```

### ç”Ÿäº§æ„å»º

```bash
npm run build               # æ„å»ºå‰ç«¯å’Œåç«¯
npm run build:backend       # ä»…æ„å»ºåç«¯
npm run build:frontend      # ä»…æ„å»ºå‰ç«¯
```

## å®‰å…¨æ³¨æ„äº‹é¡¹

- ç”Ÿäº§ç¯å¢ƒä¸­æ›´æ”¹é»˜è®¤ JWT å¯†é’¥
- ä½¿ç”¨å¼ºå¯†ç 
- ç”Ÿäº§ç¯å¢ƒå¯ç”¨ HTTPS
- é…ç½®æ­£ç¡®çš„ CORS æ¥æº
- ä¸º API ç«¯ç‚¹å®ç°é€Ÿç‡é™åˆ¶
- å®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡å’Œæ›´æ–°
- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿæ•°æ®

## é€šé“ç®¡ç†å’Œå­—æ®µæ˜ å°„

CloudSentry åŒ…å«é«˜çº§ syslog é€šé“ç®¡ç†å’Œæ™ºèƒ½å­—æ®µæ˜ å°„åŠŸèƒ½ï¼š

### é€šé“ç®¡ç†
- **è‡ªåŠ¨å‘ç°**: ä»æ–°æºæ¥æ”¶ syslog æ—¶è‡ªåŠ¨åˆ›å»ºé€šé“
- **äº‹ä»¶è·Ÿè¸ª**: ç›‘æ§æ¯ä¸ªé€šé“çš„äº‹ä»¶æ•°å’Œæœ€åäº‹ä»¶æ—¶é—´
- **è‡ªå®šä¹‰å‘½å**: ä¸ºå‘ç°çš„é€šé“åˆ†é…æœ‰æ„ä¹‰çš„åç§°
- **é€šé“æ§åˆ¶**: å¯ç”¨/ç¦ç”¨ç‰¹å®šé€šé“

### å­—æ®µæ˜ å°„
- **æ™ºèƒ½æ˜ å°„**: å°†ä¼ å…¥çš„ syslog å­—æ®µæ˜ å°„åˆ°æ•°æ®åº“æ¨¡å¼
- **è½¬æ¢ç±»å‹**: ç›´æ¥å¤åˆ¶ã€æ­£åˆ™æå–ã€æŸ¥æ‰¾è¡¨
- **ä¼˜å…ˆçº§æ§åˆ¶**: ä½¿ç”¨ä¼˜å…ˆçº§æ§åˆ¶æ˜ å°„é¡ºåº
- **é€šé“ç‰¹å®š**: æŒ‰é€šé“æˆ–å…¨å±€åº”ç”¨ä¸åŒæ˜ å°„

## ğŸ¤– AI æ™ºèƒ½å­—æ®µæ˜ å°„ï¼ˆæ–°åŠŸèƒ½ï¼‰

CloudSentry ç°åœ¨æ”¯æŒä½¿ç”¨ OpenAI å…¼å®¹ API è‡ªåŠ¨ç”Ÿæˆå­—æ®µæ˜ å°„ï¼š

### æ ¸å¿ƒåŠŸèƒ½
- **è‡ªåŠ¨ç”Ÿæˆæ˜ å°„**: AI åˆ†ææ ·æœ¬æ•°æ®å¹¶ç”Ÿæˆé€‚å½“çš„å­—æ®µæ˜ å°„
- **æ™ºèƒ½å¤ç”¨**: ç³»ç»Ÿåœ¨ç”Ÿæˆæ–°æ˜ å°„å‰æ£€æŸ¥å…¼å®¹çš„ç°æœ‰æ˜ å°„
- **å­¦ä¹ ç³»ç»Ÿ**: æ˜ å°„è¢«å­˜å‚¨å¹¶ç”¨äºç±»ä¼¼çš„æ•°æ®ç»“æ„
- **OpenAI å…¼å®¹**: æ”¯æŒ OpenAI API æˆ–å…¼å®¹æœåŠ¡ï¼ˆAzure OpenAIã€æœ¬åœ°æ¨¡å‹ç­‰ï¼‰

### å¢å¼ºçš„å¨èƒæ•°æ®æ¨¡å‹
å®‰å…¨äº‹ä»¶ç°åœ¨åŒ…å«å…¨é¢çš„å¨èƒè·Ÿè¸ªå­—æ®µï¼š
- `threatName` - å¨èƒåç§°/æ ‡è¯†ç¬¦
- `threatLevel` - å¨èƒä¸¥é‡çº§åˆ«
- `sourceIp`, `destinationIp` - å¢å¼ºçš„ç½‘ç»œä¿¡æ¯
- `sourcePort`, `destinationPort` - ç«¯å£ä¿¡æ¯
- `sourceChannel` - é€šé“æ ‡è¯†ç¬¦
- `rawData` - å®Œæ•´åŸå§‹æ•°æ®

### AI æ˜ å°„å¿«é€Ÿå…¥é—¨

1. é…ç½® OpenAI APIï¼š
```bash
POST /api/openai-config
{
  "baseUrl": "https://api.openai.com/v1",
  "apiKey": "sk-...",
  "model": "gpt-3.5-turbo"
}
```

2. ä¸ºé€šé“ç”Ÿæˆæ˜ å°„ï¼š
```bash
POST /api/channels/:id/ai-mappings/generate
{
  "sampleData": {
    "src_ip": "192.168.1.100",
    "alert_level": "3",
    "message": "æ£€æµ‹åˆ°å¨èƒ"
  }
}
```

3. åº”ç”¨ç”Ÿæˆçš„æ˜ å°„ï¼š
```bash
POST /api/channels/:id/ai-mappings/apply
{
  "mappings": [...ç”Ÿæˆçš„æ˜ å°„...]
}
```

## â° æ•°æ®ä¿ç•™ç­–ç•¥ï¼ˆæ–°åŠŸèƒ½ï¼‰

CloudSentry å®ç°äº†è½»é‡çº§æ•°æ®ä¿ç•™ç­–ç•¥ä»¥è·å¾—æœ€ä½³æ€§èƒ½ï¼š

### åŠŸèƒ½ç‰¹ç‚¹
- **7 å¤©é»˜è®¤ä¿ç•™**: ä¿æŒå¹³å°è½»é‡å’Œé«˜æ€§èƒ½
- **è‡ªåŠ¨æ¸…ç†**: æ¯å¤©è¿è¡Œä»¥åˆ é™¤æ—§æ•°æ®
- **å¯é…ç½®**: ä¿ç•™æœŸå¯é€šè¿‡æœåŠ¡è°ƒæ•´
- **PostgreSQL ä¼˜åŒ–**: é«˜æ•ˆåˆ é™¤å’Œç©ºé—´å›æ”¶

### ä¸ºä»€ä¹ˆé€‰æ‹© 7 å¤©ï¼Ÿ
- **æ€§èƒ½**: è¾ƒå°çš„æ•°æ®é›† = æ›´å¿«çš„æŸ¥è¯¢
- **è½»é‡çº§**: é€‚åˆè¾¹ç¼˜éƒ¨ç½²
- **è¶³å¤Ÿ**: å¯¹äºå®æ—¶å¨èƒç›‘æ§å·²è¶³å¤Ÿ
- **å¯å½’æ¡£**: å¦‚éœ€é•¿æœŸå­˜å‚¨å¯å¯¼å‡ºæ—§æ•°æ®

PostgreSQL ç»“åˆ 7 å¤©ä¿ç•™çª—å£å¯ä»¥å¤„ç†ï¼š
- åœ¨ä¸­ç­‰ç¡¬ä»¶ä¸Šæ¯åˆ†é’Ÿæœ€å¤š 10,000 ä¸ªäº‹ä»¶
- æ€»è®¡çº¦ 600 ä¸‡ä¸ªäº‹ä»¶
- äºšç§’çº§æŸ¥è¯¢å“åº”

## Syslog æœåŠ¡é…ç½®

### ç«¯å£è¯´æ˜
- **TCP 514**: æ ‡å‡† Syslog TCP ç«¯å£ï¼ˆå¯é ä¼ è¾“ï¼‰
- **UDP 514**: æ ‡å‡† Syslog UDP ç«¯å£ï¼ˆé«˜æ€§èƒ½ï¼‰
- **HTTP 3000**: RESTful API ç«¯ç‚¹

### åœ¨ç³»ç»Ÿè®¾ç½®ä¸­é…ç½®
å¯ä»¥åœ¨ç³»ç»Ÿè®¾ç½®é¡µé¢é…ç½® Syslog æœåŠ¡å™¨çš„ç«¯å£å’Œå¯ç”¨çŠ¶æ€ã€‚

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ï¼è¯·éšæ—¶æäº¤ Pull Requestã€‚

## è®¸å¯è¯

MIT

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜å’Œç–‘é—®ï¼Œè¯·åœ¨ GitHub ä¸Šæäº¤ Issueã€‚