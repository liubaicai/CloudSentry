:80 {
	# Set the document root
	root * /usr/share/caddy

	# Enable gzip compression
	encode gzip

	# Add security headers
	header {
		# Prevent clickjacking
		X-Frame-Options "SAMEORIGIN"
		# Prevent MIME type sniffing
		X-Content-Type-Options "nosniff"
		# Enable XSS protection
		X-XSS-Protection "1; mode=block"
		# Referrer policy
		Referrer-Policy "strict-origin-when-cross-origin"
	}

	# Proxy API requests to backend (must be before file_server)
	handle /api/* {
		reverse_proxy backend:3000 {
			header_up X-Real-IP {remote_host}
			header_up X-Forwarded-Port {server_port}
			header_up X-Forwarded-Proto {scheme}
		}
	}

	# Handle static files and SPA routing
	handle {
		try_files {path} /index.html
		file_server
	}

	# Logging
	log {
		output stdout
		format filter {
			wrap console
			fields {
				request>headers delete
				request>tls delete
				request>remote_port delete
				request>proto delete
				resp_headers delete
			}
		}
	}
}
